<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第 3 章 vuex | yuemeng</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="/favicon.svg">
    <script src="/scripts/scrollToHash.js"></script>
    <meta name="description" content="Truelove always keeps one upward.">
    
    <link rel="preload" href="/assets/css/0.styles.a871159c.css" as="style"><link rel="preload" href="/assets/js/app.98d05701.js" as="script"><link rel="preload" href="/assets/js/2.d85af416.js" as="script"><link rel="preload" href="/assets/js/41.6586ffc6.js" as="script"><link rel="prefetch" href="/assets/js/10.30c0e5c7.js"><link rel="prefetch" href="/assets/js/11.390462ac.js"><link rel="prefetch" href="/assets/js/12.bf056a5c.js"><link rel="prefetch" href="/assets/js/13.55062cc8.js"><link rel="prefetch" href="/assets/js/14.06b1ffc3.js"><link rel="prefetch" href="/assets/js/15.f959c9e9.js"><link rel="prefetch" href="/assets/js/16.d73db5f3.js"><link rel="prefetch" href="/assets/js/17.34254e2d.js"><link rel="prefetch" href="/assets/js/18.877b8b9f.js"><link rel="prefetch" href="/assets/js/19.95f2d0f9.js"><link rel="prefetch" href="/assets/js/20.5da30c36.js"><link rel="prefetch" href="/assets/js/21.b3ffb054.js"><link rel="prefetch" href="/assets/js/22.ca50e291.js"><link rel="prefetch" href="/assets/js/23.976b09b6.js"><link rel="prefetch" href="/assets/js/24.23cb2473.js"><link rel="prefetch" href="/assets/js/25.e18b6983.js"><link rel="prefetch" href="/assets/js/26.a232ba11.js"><link rel="prefetch" href="/assets/js/27.c199e385.js"><link rel="prefetch" href="/assets/js/28.5c83cee2.js"><link rel="prefetch" href="/assets/js/29.e47afd2f.js"><link rel="prefetch" href="/assets/js/3.bd12a076.js"><link rel="prefetch" href="/assets/js/30.2ac2adc3.js"><link rel="prefetch" href="/assets/js/31.1c39240a.js"><link rel="prefetch" href="/assets/js/32.f5aebe3e.js"><link rel="prefetch" href="/assets/js/33.5d10f83e.js"><link rel="prefetch" href="/assets/js/34.10b76109.js"><link rel="prefetch" href="/assets/js/35.e5d84c1f.js"><link rel="prefetch" href="/assets/js/36.4b7f1032.js"><link rel="prefetch" href="/assets/js/37.e948af12.js"><link rel="prefetch" href="/assets/js/38.c7474d5e.js"><link rel="prefetch" href="/assets/js/39.9e53338a.js"><link rel="prefetch" href="/assets/js/4.8d61a696.js"><link rel="prefetch" href="/assets/js/40.0f16b2c6.js"><link rel="prefetch" href="/assets/js/42.f35cde68.js"><link rel="prefetch" href="/assets/js/43.bf91ac11.js"><link rel="prefetch" href="/assets/js/44.d6a6e091.js"><link rel="prefetch" href="/assets/js/5.4803dd30.js"><link rel="prefetch" href="/assets/js/6.2b2b55cb.js"><link rel="prefetch" href="/assets/js/7.48639d38.js"><link rel="prefetch" href="/assets/js/8.3ac5769e.js"><link rel="prefetch" href="/assets/js/9.b8436733.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a871159c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.svg" alt="yuemeng" class="logo"> <span class="site-name can-hide">yuemeng</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端技术专题" class="dropdown-title"><span class="title">前端技术专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端技术专题" class="mobile-dropdown-title"><span class="title">前端技术专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/topics/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/topics/ts/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/topics/vue/" class="nav-link router-link-active">
  Vue.js
</a></li><li class="dropdown-item"><!----> <a href="/topics/broswer/" class="nav-link">
  浏览器
</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他专题" class="dropdown-title"><span class="title">其他专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他专题" class="mobile-dropdown-title"><span class="title">其他专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/node/" class="nav-link">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/others/electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/others/nest/" class="nav-link">
  Nest.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机科学" class="mobile-dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/cp/" class="nav-link">
  编译原理
</a></li><li class="dropdown-item"><!----> <a href="/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/cs/cn.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/thoughts/" class="nav-link">
  随想
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端技术专题" class="dropdown-title"><span class="title">前端技术专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端技术专题" class="mobile-dropdown-title"><span class="title">前端技术专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/topics/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/topics/ts/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/topics/vue/" class="nav-link router-link-active">
  Vue.js
</a></li><li class="dropdown-item"><!----> <a href="/topics/broswer/" class="nav-link">
  浏览器
</a></li></ul></div></div><div class="nav-item"><a href="/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他专题" class="dropdown-title"><span class="title">其他专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他专题" class="mobile-dropdown-title"><span class="title">其他专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/node/" class="nav-link">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/others/electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/others/nest/" class="nav-link">
  Nest.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机科学" class="mobile-dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/cp/" class="nav-link">
  编译原理
</a></li><li class="dropdown-item"><!----> <a href="/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/cs/cn.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/thoughts/" class="nav-link">
  随想
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/topics/vue/" aria-current="page" class="sidebar-link">Vue.js</a></li><li><a href="/topics/vue/basic.html" class="sidebar-link">第 1 章 基础知识</a></li><li><a href="/topics/vue/router.html" class="sidebar-link">第 2 章 vue-router</a></li><li><a href="/topics/vue/store.html" aria-current="page" class="active sidebar-link">第 3 章 vuex</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_1、说明" class="sidebar-link">1、说明</a></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_2、使用" class="sidebar-link">2、使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_1-定义-store" class="sidebar-link">(1) 定义 store</a></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_2-使用-state" class="sidebar-link">(2) 使用 state</a></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_3-使用-getter" class="sidebar-link">(3) 使用 getter</a></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_4-触发同步-mutation" class="sidebar-link">(4) 触发同步 mutation</a></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_5-触发异步-action" class="sidebar-link">(5) 触发异步 action</a></li></ul></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_3、模块化" class="sidebar-link">3、模块化</a></li><li class="sidebar-sub-header"><a href="/topics/vue/store.html#_4、双向绑定场景" class="sidebar-link">4、双向绑定场景</a></li></ul></li><li><a href="/topics/vue/theory.html" class="sidebar-link">第 4 章 进入 vue 原理</a></li><li><a href="/topics/vue/cli.html" class="sidebar-link">第5章 CLI 构建工具</a></li><li><a href="/topics/vue/tools.html" class="sidebar-link">第 6 章 常用依赖</a></li><li><a href="/topics/vue/other.html" class="sidebar-link">第 7 章 其他技术</a></li><li><a href="/topics/vue/vue3.html" class="sidebar-link">第 8 章 vue3</a></li><li><a href="/topics/vue/vite.html" class="sidebar-link">第 9 章 Vite</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第-3-章-vuex"><a href="#第-3-章-vuex" class="header-anchor">#</a> 第 3 章 vuex</h1> <h2 id="_1、说明"><a href="#_1、说明" class="header-anchor">#</a> 1、说明</h2> <blockquote><p>这里照例是以适配<code>vue2</code>的<code>3.x</code>版本来讲，<code>4.x</code>改变的内容会相应补充。</p></blockquote> <p>Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式。它采用<code>集中式</code>存储管理应用的所有组件的状态，并以相应的规则保证状态以一种<code>可预测</code>的方式发生变化。
在整个体系中的位置：
<img src="https://v3.vuex.vuejs.org/vuex.png" alt="在整个体系的位置">
可见状态（数据）被渲染到组件上展示，组件交互触发变更数据，需要变更的数据被提交，最后修改状态。
:::note 注意
<code>vuex</code>是把<code>$store</code>挂载到vm实例上的，在刷新页面时vm实例会被销毁，所以原来保存的状态将会丢失。你可以通过监听页面刷新事件将需要的状态手动保存到<code>sessionStorage</code>或者<code>localStorage</code>，并在新创建的实例后重新存到<code>store</code>。除此之外有个叫<code>vuex-persistedstate</code>的工具可以自动帮你这样做，就可以参考这个<a href="https://stackoverflow.com/a/58841356/14456170" target="_blank" rel="noopener noreferrer">回答<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>使用。但是不建议存到<code>cookie</code>中，一是没必要把这些状态带到后端去，在这<code>cookie</code>容量限制在<code>8k</code>。
:::</p> <h2 id="_2、使用"><a href="#_2、使用" class="header-anchor">#</a> 2、使用</h2> <h3 id="_1-定义-store"><a href="#_1-定义-store" class="header-anchor">#</a> (1) 定义 store</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuex<span class="token punctuation">.</span>Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'...'</span><span class="token punctuation">,</span> <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">doneTodos</span><span class="token operator">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">todo</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token literal-property property">mutations</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
        state<span class="token punctuation">.</span>count <span class="token operator">+=</span>n
      <span class="token keyword">else</span>
        state<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-使用-state"><a href="#_2-使用-state" class="header-anchor">#</a> (2) 使用 state</h3> <h4 id="_1-直接使用"><a href="#_1-直接使用" class="header-anchor">#</a> ① 直接使用</h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{this.$store.state.count}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="_2-挂载到-computed"><a href="#_2-挂载到-computed" class="header-anchor">#</a> ② 挂载到 computed</h4> <blockquote><p>直接使用可复用性不高，直接挂载到<code>data</code>不合适，因为<code>data</code>在我们使用时默认是可以任意修改的，而状态我们希望能受控地修改。显然<code>computed</code>更符合这种定位。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">count</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count
    <span class="token punctuation">}</span>
</code></pre></div><p>也可以使用<code>mapState</code>函数快速获取多个状态：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 箭头函数可使代码更简练</span>
    <span class="token function-variable function">count</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>

    <span class="token comment">// 传字符串参数 'count' 等同于 `state =&gt; state.count`</span>
    <span class="token literal-property property">countAlias</span><span class="token operator">:</span> <span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span>

    <span class="token comment">// 为了能够使用 `this` 获取局部状态，必须使用常规函数，因为computed是直接作为vm实例的方法使用的。</span>
    <span class="token function">countPlusLocalState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-使用-getter"><a href="#_3-使用-getter" class="header-anchor">#</a> (3) 使用 getter</h3> <p>相当于对<code>state</code>多包装一层，且相同<code>getter</code>在不同位置获取时会开启缓存。
之后可以通过<code>this.$store.getters</code>或者<code>mapGetters</code>使用。</p> <blockquote><p>注意是<code>getters</code></p></blockquote> <p>除此之外<code>getter</code>本身也能返回一个函数，而不仅像普通<code>computed</code>一样只能返回值，此时就能在调用时传递参数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">getters</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function-variable function">getTodoById</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>todos<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">todo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> todo<span class="token punctuation">.</span>id <span class="token operator">===</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但这种方式就不能再使用缓存了。</p> <h3 id="_4-触发同步-mutation"><a href="#_4-触发同步-mutation" class="header-anchor">#</a> (4) 触发同步 mutation</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">&quot;increment&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同时多个<code>mutation</code>也能展开到<code>methods</code>中使用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">add</span><span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token comment">// 将 `this.add()` 映射为 `this.$store.commit('increment')`</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>⚠️</p> <ul><li>不要使用<code>mutation</code>直接给对象添加属性（这是 vue2 响应式要求的），在使用前就把要用的属性初始化好。或者使用<code>Vue.set()</code>。</li> <li><code>mutation</code>必须是同步事务，不然会造成预测混乱，违背了<code>vuex</code>最初设计的目的。</li></ul> <h3 id="_5-触发异步-action"><a href="#_5-触发异步-action" class="header-anchor">#</a> (5) 触发异步 action</h3> <p><code>action</code>用来提交多个<code>mutation</code>，可以异步地组织<code>mutation</code>以及访问整个<code>store</code>，但不能直接修改<code>state</code>。
使用起来和<code>mutation</code>差不多，使用<code>this.$store.dispatch</code>或者<code>mapActions</code>展开到<code>methods</code>。</p> <h2 id="_3、模块化"><a href="#_3、模块化" class="header-anchor">#</a> 3、模块化</h2> <p>这部分暂时先不写，就是组建出大型的数据仓库，没有接触过使用场景。
<a href="https://v3.vuex.vuejs.org/zh/guide/modules.html#%E6%A8%A1%E5%9D%97%E5%8A%A8%E6%80%81%E6%B3%A8%E5%86%8C" target="_blank" rel="noopener noreferrer">模块化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_4、双向绑定场景"><a href="#_4、双向绑定场景" class="header-anchor">#</a> 4、双向绑定场景</h2> <p>如果将状态使用<code>v-model</code>绑定到表单会怎样？在严格模式下会直接报错。因为<code>state</code>不允许在<code>mutation</code>之外的地方被修改。</p> <blockquote><p>同时<code>computed</code>是只读的，强行赋值报错，但修改是有效的，即最终最作用到<code>state</code>上，只是响应式不会起作用。</p></blockquote> <p>可以配置<code>computed</code>的<code>set</code>来达到捕获修改的目的，之后手动触发状态修改：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>message
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'updateMessage'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/24/2022, 3:24:45 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/topics/vue/router.html" class="prev">
        第 2 章 vue-router
      </a></span> <span class="next"><a href="/topics/vue/theory.html">
        第 4 章 进入 vue 原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.98d05701.js" defer></script><script src="/assets/js/2.d85af416.js" defer></script><script src="/assets/js/41.6586ffc6.js" defer></script>
  </body>
</html>
