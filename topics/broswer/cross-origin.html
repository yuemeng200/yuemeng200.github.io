<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第 1 章 跨域 | yuemeng</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="/favicon.svg">
    <script src="/scripts/scrollToHash.js"></script>
    <meta name="description" content="Truelove always keeps one upward.">
    
    <link rel="preload" href="/assets/css/0.styles.6ab8e904.css" as="style"><link rel="preload" href="/assets/js/app.0b1ca762.js" as="script"><link rel="preload" href="/assets/js/2.84b8dd24.js" as="script"><link rel="preload" href="/assets/js/35.bc1c09d1.js" as="script"><link rel="prefetch" href="/assets/js/10.35c2fab5.js"><link rel="prefetch" href="/assets/js/11.94536566.js"><link rel="prefetch" href="/assets/js/12.12cd7983.js"><link rel="prefetch" href="/assets/js/13.a3540aef.js"><link rel="prefetch" href="/assets/js/14.635b072e.js"><link rel="prefetch" href="/assets/js/15.461a0839.js"><link rel="prefetch" href="/assets/js/16.a11aae15.js"><link rel="prefetch" href="/assets/js/17.47944ad5.js"><link rel="prefetch" href="/assets/js/18.fc74f27e.js"><link rel="prefetch" href="/assets/js/19.366b62fb.js"><link rel="prefetch" href="/assets/js/20.60f3e2a7.js"><link rel="prefetch" href="/assets/js/21.5bf5ab3c.js"><link rel="prefetch" href="/assets/js/22.963d9696.js"><link rel="prefetch" href="/assets/js/23.4ad70fdf.js"><link rel="prefetch" href="/assets/js/24.0b548e67.js"><link rel="prefetch" href="/assets/js/25.ddb447de.js"><link rel="prefetch" href="/assets/js/26.c6430981.js"><link rel="prefetch" href="/assets/js/27.47798acc.js"><link rel="prefetch" href="/assets/js/28.d22a74e8.js"><link rel="prefetch" href="/assets/js/29.298f225a.js"><link rel="prefetch" href="/assets/js/3.02a15dfe.js"><link rel="prefetch" href="/assets/js/30.3886b891.js"><link rel="prefetch" href="/assets/js/31.fef34dfb.js"><link rel="prefetch" href="/assets/js/32.989a2211.js"><link rel="prefetch" href="/assets/js/33.83bfdb63.js"><link rel="prefetch" href="/assets/js/34.166d9d41.js"><link rel="prefetch" href="/assets/js/36.5aed62db.js"><link rel="prefetch" href="/assets/js/37.fb37dcf4.js"><link rel="prefetch" href="/assets/js/38.34cb339f.js"><link rel="prefetch" href="/assets/js/39.4f5b9d73.js"><link rel="prefetch" href="/assets/js/4.b0c61de2.js"><link rel="prefetch" href="/assets/js/40.d09b454e.js"><link rel="prefetch" href="/assets/js/41.0df120f1.js"><link rel="prefetch" href="/assets/js/42.77814080.js"><link rel="prefetch" href="/assets/js/43.41894abf.js"><link rel="prefetch" href="/assets/js/44.06cffeca.js"><link rel="prefetch" href="/assets/js/45.fd6d392d.js"><link rel="prefetch" href="/assets/js/46.b5b5ba92.js"><link rel="prefetch" href="/assets/js/47.7bda5805.js"><link rel="prefetch" href="/assets/js/48.8067c058.js"><link rel="prefetch" href="/assets/js/49.a271bf7f.js"><link rel="prefetch" href="/assets/js/5.1c6984db.js"><link rel="prefetch" href="/assets/js/50.c55605f5.js"><link rel="prefetch" href="/assets/js/51.07b80eb6.js"><link rel="prefetch" href="/assets/js/52.216a8819.js"><link rel="prefetch" href="/assets/js/53.b7fabd75.js"><link rel="prefetch" href="/assets/js/54.d23c165c.js"><link rel="prefetch" href="/assets/js/6.4ee0d085.js"><link rel="prefetch" href="/assets/js/7.f03a6fb6.js"><link rel="prefetch" href="/assets/js/8.da0688d5.js"><link rel="prefetch" href="/assets/js/9.def523e6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6ab8e904.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicon.svg" alt="yuemeng" class="logo"> <span class="site-name can-hide">yuemeng</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端技术专题" class="dropdown-title"><span class="title">前端技术专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端技术专题" class="mobile-dropdown-title"><span class="title">前端技术专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/topics/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/topics/ts/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/topics/vue/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-item"><!----> <a href="/topics/broswer/" class="nav-link router-link-active">
  浏览器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/leetcode/" class="nav-link">
  题解
</a></li><li class="dropdown-item"><!----> <a href="/algorithm/summary/" class="nav-link">
  总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他专题" class="dropdown-title"><span class="title">其他专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他专题" class="mobile-dropdown-title"><span class="title">其他专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/node/" class="nav-link">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/others/rust/" class="nav-link">
  rust
</a></li><li class="dropdown-item"><!----> <a href="/others/electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/others/nest/" class="nav-link">
  Nest.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机科学" class="mobile-dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/cp/" class="nav-link">
  编译原理
</a></li><li class="dropdown-item"><!----> <a href="/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/cs/cn.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/thoughts/" class="nav-link">
  随想
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端技术专题" class="dropdown-title"><span class="title">前端技术专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端技术专题" class="mobile-dropdown-title"><span class="title">前端技术专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/topics/js/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/topics/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/topics/ts/" class="nav-link">
  Typescript
</a></li><li class="dropdown-item"><!----> <a href="/topics/vue/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-item"><!----> <a href="/topics/broswer/" class="nav-link router-link-active">
  浏览器
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithm/leetcode/" class="nav-link">
  题解
</a></li><li class="dropdown-item"><!----> <a href="/algorithm/summary/" class="nav-link">
  总结
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他专题" class="dropdown-title"><span class="title">其他专题</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他专题" class="mobile-dropdown-title"><span class="title">其他专题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/node/" class="nav-link">
  Node.js
</a></li><li class="dropdown-item"><!----> <a href="/others/rust/" class="nav-link">
  rust
</a></li><li class="dropdown-item"><!----> <a href="/others/electron/" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/others/nest/" class="nav-link">
  Nest.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机科学" class="mobile-dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/cs/cp/" class="nav-link">
  编译原理
</a></li><li class="dropdown-item"><!----> <a href="/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/cs/cn.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/thoughts/" class="nav-link">
  随想
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/topics/broswer/" aria-current="page" class="sidebar-link">浏览器专题</a></li><li><a href="/topics/broswer/cross-origin.html" aria-current="page" class="active sidebar-link">第 1 章 跨域</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/topics/broswer/cross-origin.html#_1、什么是跨域" class="sidebar-link">1、什么是跨域？</a></li><li class="sidebar-sub-header"><a href="/topics/broswer/cross-origin.html#_2、跨域资源共享" class="sidebar-link">2、跨域资源共享</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/topics/broswer/cross-origin.html#_1-简单请求" class="sidebar-link">(1) 简单请求</a></li><li class="sidebar-sub-header"><a href="/topics/broswer/cross-origin.html#_2-非简单请求" class="sidebar-link">(2) 非简单请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/topics/broswer/cross-origin.html#_3、jsonp" class="sidebar-link">3、JSONP</a></li><li class="sidebar-sub-header"><a href="/topics/broswer/cross-origin.html#_4、反向代理" class="sidebar-link">4、反向代理</a></li></ul></li><li><a href="/topics/broswer/cache.html" class="sidebar-link">第 2 章 浏览器缓存策略</a></li><li><a href="/topics/broswer/security.html" class="sidebar-link">第3章 安全</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第-1-章-跨域"><a href="#第-1-章-跨域" class="header-anchor">#</a> 第 1 章 跨域</h1> <h2 id="_1、什么是跨域"><a href="#_1、什么是跨域" class="header-anchor">#</a> 1、什么是跨域？</h2> <p>浏览器存在同源策略，当 js 脚本请求其他源的网页去读取另一个源（域名、端口、协议）的资源时，发生跨域。</p> <blockquote><p><code>&lt;script&gt;</code>标签引入其他资源（获取到内容直接作为脚本执行）和<code>表单提交</code>并不会造成跨域。</p></blockquote> <p>早期解决跨域使用<code>JSONP</code>，但实在太麻烦。
通过 W3C 的<code>CORS</code>（跨域资源共享）标准配置后端服务器是跨域的标准解决方案。
而在前后端分离的场景下，还可以通过<code>反向代理</code>来解决跨域问题，在开发状态下可以通过配置<code>devserver</code>的请求转发达到跨域效果。</p> <blockquote><p>同源策略发生在浏览器的脚本向服务器发出的请求，本地起得大服务器作为客户端不存在这个限制，比如<code>postman</code>。</p></blockquote> <h2 id="_2、跨域资源共享"><a href="#_2、跨域资源共享" class="header-anchor">#</a> 2、跨域资源共享</h2> <p>跨域的 AJAX 分为简单请求和非简单请求。</p> <h3 id="_1-简单请求"><a href="#_1-简单请求" class="header-anchor">#</a> (1) 简单请求</h3> <p>满足以下条件的为简单请求</p> <ul><li>请求方法：
<ul><li>GET</li> <li>POST</li> <li>HEAD</li></ul></li> <li>请求头：
<ul><li>用户代理自动设置的首部字段（例如 Connection，User-Agent）</li> <li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Last-Event-ID</li> <li>Content-Type
且只能为<code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code>或<code>text/plain</code>，不能发<code>json</code></li></ul></li></ul> <p>简单请求会自动添加<code>origin</code>字段，值为当前的源地址。
如果服务器接受了请求，返回的响应的首部应具有<code>Access-Control-Allow-Origin</code>字段，值为接受的源地址或者<code>*</code>，否则浏览器不会接收该响应。</p> <blockquote><p>如果需要携带<code>Cookie</code>，请求需要配置<code>withCredentials=true</code>，响应头中的<code>Access-Control-Allow-Credentials</code>字段代表服务器是否同意接受<code>Cookie</code>。
对于 CORS 响应，<code>getResponseHeader()</code>方法默认只能拿到 6 个基本字段：<code>Cache-Control</code>、<code>Content-Language</code>、<code>Content-Type</code>、<code>Expires</code>、<code>Last-Modified</code>、<code>Pragma</code>。如果想拿到服务器设置的其他字段，就必须在响应头的<code>Access-Control-Expose-Headers</code>里面指定。</p></blockquote> <h3 id="_2-非简单请求"><a href="#_2-非简单请求" class="header-anchor">#</a> (2) 非简单请求</h3> <p>相较简单请求，非简单请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为&quot;预检&quot;请求（preflight）。
预检请求会询问服务器当前的请求方法和请求头是否被支持，通过<code>Access-Control-Request-Method</code>和<code>Access-Control-Request-Headers</code>指定。
服务器会返回被当前询问的结果响应，同意时还会有<code>Access-Control-Max-Age</code>字段，用来指定当前预检许可的有效期。
之后流程和简单请求一致。</p> <h2 id="_3、jsonp"><a href="#_3、jsonp" class="header-anchor">#</a> 3、JSONP</h2> <p>JSONP 的本质即<code>&lt;script&gt;</code>标签请求（只支持 get），只是被封装成了函数，对于获取的响应直接作为脚本执行。JSONP 的优势在于支持老式浏览器，以及可以向不支持 CORS 的网站请求数据，只是功能太弱。
实现参考：
JSONP 函数根据传入的 url 和参数构造 GET 请求，同时确保后端知道需要返回的回调的名字（后端会封装个函数调用的字符串给前端）。</p> <details class="custom-block details"><summary>JSONP 实现</summary> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token constant">JSONP</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> params<span class="token punctuation">,</span> callbackKey<span class="token punctuation">,</span> callback <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在参数里制定 callback 的名字</span>
  params <span class="token operator">=</span> params <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  params<span class="token punctuation">[</span>callbackKey<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;jsonpCallback&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 预留 callback</span>
  window<span class="token punctuation">.</span>jsonpCallback <span class="token operator">=</span> callback<span class="token punctuation">;</span>
  <span class="token comment">// 拼接参数字符串</span>
  <span class="token keyword">const</span> paramKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> paramString <span class="token operator">=</span> paramKeys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 插入 DOM 元素</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>paramString<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token constant">JSONP</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://s.weibo.com/ajax/jsonp/suggestion&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">callbackKey</span><span class="token operator">:</span> <span class="token string">&quot;_cb&quot;</span><span class="token punctuation">,</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></details> <h2 id="_4、反向代理"><a href="#_4、反向代理" class="header-anchor">#</a> 4、反向代理</h2> <p><code>正向代理</code>隐藏客户端，<code>反向代理</code>隐藏服务器。
<code>Nginx</code>配置如下：</p> <div class="language-conf extra-class"><pre class="language-text"><code>server {
    listen       80;
    server_name  wwww.baidu.com;
    location / {
        root   html;
        index  index.html index.htm;
        location ^~ /api {
          rewrite ^/api/(.*)$ /$1 break;
          proxy_cookie_domain wwww.baidu.com api.baidu.com;
          proxy_pass https://api.baidu.com/;
        }
    }
}
</code></pre></div><p>此时即可把访问<code>www.baidu.com/api</code>的请求转发到<code>api.baidu.com/api</code>来处理。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">4/9/2022, 1:55:32 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/topics/broswer/" class="prev router-link-active">
        浏览器专题
      </a></span> <span class="next"><a href="/topics/broswer/cache.html">
        第 2 章 浏览器缓存策略
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0b1ca762.js" defer></script><script src="/assets/js/2.84b8dd24.js" defer></script><script src="/assets/js/35.bc1c09d1.js" defer></script>
  </body>
</html>
